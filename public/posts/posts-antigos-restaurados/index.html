<!--
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- -->
<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="shrink-to-fit=no,width=device-width,height=device-height,initial-scale=1,user-scalable=1"><meta name=description content="My corner of the web"><title>Adler Medrado's little piece of turf</title><link rel=author href=/humans.txt><link rel=canonical href=https://adlermedrado.com.br><link href=/css/styles.css rel=stylesheet></head><body><header><nav class=navbar role=navigation><div class=navbar_left><a href=/><strong>Adler Medrado</strong></a></div><div class=navbar_right><a href=/posts>Posts</a>
<a href=/tags>Posts by Tags</a></div></nav></header><main><section class=section><article><div><h1>Posts antigos restaurados</h1><div><div><p><small><time>December 31, 2017</time>
|
4 minutes read</small></p></div><span class=line_break></span></div><div class=content><p>É muito legal ser programador e participar de projetos com as mais variadas dimensões e complexidades, mas uma das
coisas que eu acho mais legal em ser um programador é o fato de poder utilizar este conhecimento para automatizar
tarefas e resolver problemas do cotidiano.</p><p>Resolvi escrever este post justamente porque eu automatizei uma tarefa que me tomaria algumas horas com um pequeno e
simples script <a href=https://www.python.org/>python</a>.</p><p>Eu achei legal escrever um pouco sobre isso porque pode servir de exemplo para pessoas que não trabalham com programação
diariamente de que elas podem se beneficiar em conhecer um pouco e tentar otimizar tarefas repetitivas.</p><h3 id=contextualizando>Contextualizando</h3><p><a href=https://github.com/adlermedrado-archive/dangolino>No início de 2012 eu implementei um projeto pessoal para poder gerar meu blog com páginas estáticas</a>,
estilo Jekyl, Pelican, etc., mas muito mais simples pois foi feito para atender somente as minhas necessidades.</p><p>Eu implementei também um pequeno importador para converter meu blog <a href=https://wordpress.com/>wordpress</a> neste novo
formato. Tudo funcionou legal, e usei durante um bom tempo, mas passaram-se uns anos e eu precisei trocar de computador
e achei um saco atualizar todas as libs necessárias para o projeto funcionar, então eu voltei para o wordpress.</p><p>Quando eu voltei ao Wordpress eu deixei alguns desses posts antigos para trás, não os publiquei novamente e eles ficaram
num backup para até um dia em que eu tivesse paciência, publica-los novamente. E então passaram-se alguns anos.</p><p>Recentemente eu passei a utilizar o <a href=https://blog.getpelican.com/>pelican</a>, que é um gerador de sites estáticos e ontem
eu me lembrei dos posts antigos que estavam nos meus backups e decidi que era a oportunidade de importa-los novamente.</p><p>O problemas é que isso me daria muito trabalho, e uma das coisas que programador menos gosta é de ficar fazendo trabalho
braçal, então, tentei automatizar o processo.</p><h3 id=a-solução>A solução</h3><p>Exisitiam em torno de 200 posts, imagina copiar isso um a um manualmente, editar e salvar no formato do Pelican no
diretório correto? <em>No way</em>.</p><p>A primeira coisa que eu fiz foi analisar se quando eu gerei os arquivos estáticos (HTML), eu o fiz deixando-os
padronizados, mas nem todos estavam dentro do mesmo padrão. <em>Shame on me</em>, lição aprendida, bola pra frente.</p><p>Eu salvei todos os arquivos HTML em um diretório chamado <em>old</em> e os posts estavam salvos da seguinte maneira:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>| |<span style=color:#ae81ff>\_\_\_\_</span><span style=color:#ae81ff>2010</span>   
</span></span><span style=display:flex><span>| | |<span style=color:#ae81ff>\_\_\_\_</span><span style=color:#ae81ff>04</span>   
</span></span><span style=display:flex><span>| | | |<span style=color:#ae81ff>\_\_\_\_</span>arquivos html
</span></span></code></pre></div><p>Não coloquei toda a árvore aqui para não ficar muito grande, mas basicamente os arquivos estavam agrupados por <strong>ANO</strong> e <strong>MÊS</strong>, então para processa-los eu precisei iterar no diretório <em>old</em> e seus subdiretórios:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>for</span> subdir, dirs, files in os.walk<span style=color:#f92672>(</span>content<span style=color:#ae81ff>\_</span>root<span style=color:#f92672>)</span>:   
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> file in files: <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;images&#39;</span> not in subdir:   
</span></span><span style=display:flex><span>with open<span style=color:#f92672>(</span>file<span style=color:#ae81ff>\_</span>path, <span style=color:#e6db74>&#39;r&#39;</span><span style=color:#f92672>)</span> as content<span style=color:#ae81ff>\_</span>file:   
</span></span></code></pre></div><p>O diretório <em>old</em> tem um subdiretório chamado images e eu não processei o que tinha dentro dele justamente por só conter
imagens.</p><p>O próximo passo foi fazer o parse do HTML para poder trabalhar com o texto, para isso eu usei a biblioteca
BeautifoulSoup:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>extract_data</span>():   
</span></span><span style=display:flex><span>    content <span style=color:#f92672>=</span> content_file<span style=color:#f92672>.</span>read()   
</span></span><span style=display:flex><span>    soup <span style=color:#f92672>=</span> BeautifulSoup(content, <span style=color:#e6db74>&#34;html.parser&#34;</span>)   
</span></span><span style=display:flex><span>    post_title <span style=color:#f92672>=</span> soup<span style=color:#f92672>.</span>html<span style=color:#f92672>.</span>body<span style=color:#f92672>.</span>h1<span style=color:#f92672>.</span>text   
</span></span><span style=display:flex><span>    post_content\_data <span style=color:#f92672>=</span> soup<span style=color:#f92672>.</span>findAll(<span style=color:#e6db74>&#39;div&#39;</span>, {<span style=color:#e6db74>&#39;class&#39;</span>: <span style=color:#e6db74>&#39;span12&#39;</span>})\[<span style=color:#ae81ff>1</span>\]  
</span></span><span style=display:flex><span>    post_date <span style=color:#f92672>=</span> post\_content\_data<span style=color:#f92672>.</span>find(<span style=color:#e6db74>&#39;p&#39;</span>)<span style=color:#f92672>.</span>text<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;Post date:&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)<span style=color:#f92672>.</span>strip()   
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> post_date:   
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;Post date not found&#34;</span>)   
</span></span><span style=display:flex><span>        post_content <span style=color:#f92672>=</span> post\_content\_data<span style=color:#f92672>.</span>text<span style=color:#f92672>.</span>strip()   
</span></span><span style=display:flex><span>        post_content <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>sub(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;Post date: (d+/d+/d+)&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, post\_content)   
</span></span><span style=display:flex><span>        post_content <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>sub(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;- (d+:d+:d+)&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, post\_content)  
</span></span><span style=display:flex><span>        post_slug <span style=color:#f92672>=</span> file<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;.html&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {   
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;post_title&#39;</span>: replace\_invalid\_chars(post\_title),  
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;post_date&#39;</span>: post\_date, <span style=color:#e6db74>&#39;post\_content&#39;</span>: replace\_invalid\_chars(post\_content),   
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;post_slug&#39;</span>: replace\_invalid\_chars(post\_slug),   
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>Esta função basicamente obtinha as informações do post que eu precisava (titulo, data, slug e conteúdo) e fazia alguns
tratamentos nestes dados, porque eu não me lembro o motivo, mas muitos caracteres estavam incorretos.</p><p>Eu também removi trechos de texto desnecessários, removi espaços em branco das extremidades e coisas simples assim, essa
função retorna um dicionário com as informações necessárias para salvar o novo arquivo.</p><p>Na sequência eu uma função que criava o novo arquivo markdown, adicionava nele o conteúdo no formato do Pelican e o
salva:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>convert_to_new_post</span>(post_contents):   
</span></span><span style=display:flex><span>    info_message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;**AVISO:** _Este post é muito antigo e seu conteúdo provavelmente está defasado, permanecendo</span>
</span></span><span style=display:flex><span>    no meu blog apenas por motivos históricos<span style=color:#f92672>.</span>_<span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    new_post_file <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;converted/</span><span style=color:#e6db74>{</span>post_contents<span style=color:#960050;background-color:#1e0010>\</span>[<span style=color:#e6db74>&#39;post_slug&#39;</span><span style=color:#960050;background-color:#1e0010>\</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>.md&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    new_post <span style=color:#f92672>=</span> open(new_post_file, <span style=color:#e6db74>&#39;w&#39;</span>)   
</span></span><span style=display:flex><span>    new_post<span style=color:#f92672>.</span>write(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Title: </span><span style=color:#e6db74>{</span>post_contents<span style=color:#960050;background-color:#1e0010>\</span>[<span style=color:#e6db74>&#39;post_title&#39;</span><span style=color:#960050;background-color:#1e0010>\</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)  
</span></span><span style=display:flex><span>    new_post<span style=color:#f92672>.</span>write(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Date: </span><span style=color:#e6db74>{</span>post_contents<span style=color:#960050;background-color:#1e0010>\</span>[<span style=color:#e6db74>&#39;post_date&#39;</span><span style=color:#960050;background-color:#1e0010>\</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)  
</span></span><span style=display:flex><span>    new_post<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#34;Author: adlern&#34;</span>) new_post<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#34;Tags: old&#34;</span>)  
</span></span><span style=display:flex><span>    new_post<span style=color:#f92672>.</span>write(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Slug: </span><span style=color:#e6db74>{</span>post_contents<span style=color:#960050;background-color:#1e0010>\</span>[<span style=color:#e6db74>&#39;post_slug&#39;</span><span style=color:#960050;background-color:#1e0010>\</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)  
</span></span><span style=display:flex><span>    new_post<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#34;Status: published&#34;</span>)   
</span></span><span style=display:flex><span>    new_post<span style=color:#f92672>.</span>write(info_message <span style=color:#f92672>+</span> post_contents[<span style=color:#e6db74>&#39;post_content&#39;</span>])  
</span></span><span style=display:flex><span>    new_post<span style=color:#f92672>.</span>close()
</span></span></code></pre></div><h3 id=nem-todos-os-posts-foram-importados>Nem todos os posts foram importados</h3><p>No final eu descartei alguns posts pois eles eram contextualmente irrelevantes para o site, e apesar de eu não gostar de
jogar história fora, aqueles eram tão bobinhos que sinceramente, não farão muita falta.</p><p>Mas eles estão salvos aqui, para caso eu mude de idéia algum dia.</p><h3 id=código-completo-e-considerações-finais>Código completo e considerações finais</h3><p>Se eu não tivesse criado este script eu teria que fazer esse processo manualmente em duas centenas de arquivos e
certamente não seria algo agradável e eu levei algo em torno de 30 minutos para escreve-lo.</p><p>O código completo está <a href=https://gist.github.com/adlermedrado/6159cbf6b3fcca2473c175816f7ff94f>salvo em um Gist</a> a quem
interessar possa.</p></div></div></article><div><div><div><a href=https://adlermedrado.com.br/posts/do-php-ao-python/>&#8592; Do PHP ao Python</a>
|
<a href=https://adlermedrado.com.br/posts/enabling-click-and-drag-on-macbook/>Enabling Click and Drag on MacBook &#8594;</a></div></div></div></section></main><span class=line_break></span>
<span class=line_break></span><footer><div><p><small>&copy; 1996-2023 Adler Medrado</small></p></div><div class=gpg_signed_info><p>All pages on this website are PGP signed.
Import my <a href=/pub-key.asc>public key</a> and check with <em>curl https://adlermedrado.com.br/posts/posts-antigos-restaurados/ | gpg --verify</em></p></div></footer></body></html><!--
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEXZd8hNji/2MRgqvhKWCEk4dBO2AFAmUoGfAACgkQKWCEk4dB
O2C/Mg//Tx268ui96rHT/wP8aJUD2V5LZJWo4CMvWtHN/S0z2ypu7vYOSQrYj2da
Ccl49MJcCBlwo/fvnk/uq2JPk75GxsN+Z5RcDoH/Y8jJCMnJ+/CuAyfUvspE3xsb
jjq762QM4fq90IhP/ef/W6p7+Yc3sHfSfggM9PmNCXp+dC5pgwenEHul0H6YbhfQ
pvr83QbKq+DYZ0vwd3x7XRao0SyOoGoAp/PeUiQXW3b0a/FzVJCxNqEl79tTmRab
edGfNV+iE+wWwYayx801d1oa6FrCWaJLjM+9dIgaDsDY8iMxM/fXa7GA8BcvPMoJ
YLRVkNtTp9Ii1SbkzR7R5wCs3awEEQ9CklHVK8I/r/YD35iNhh9j+c8KKQ3QTvti
R4mYf4RDWMLodoQu9UcbvNQ9SFco0timTbNL40w0is5GFJdulZUgyUFTRdXc2h2X
L+OxctV5K9qEnDb94A3R3R8hr6DdJuC1TFEbXIoU8DD1sFAoXW0l+KS2SaAzgh7g
2Elwa18STQ3rafugH1+RQ5LZmwDq43bs3gi9fQBPwJVaVfvI0FuDrkM9VeBL684i
edOOgYbA18iogj4xKboxuV0kitZpcB6ZbBLX+3JeVmfPB20pk+NgGNlJe0ylgVUh
MJ2bs1kasoPTh4d0Jc6vlYBhO+DPveHb5WRCjbpASo9jrD531HA=
=EL2U
-----END PGP SIGNATURE-----
-->
